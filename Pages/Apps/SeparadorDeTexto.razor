@page "/separadortxt"
@using System.Text

<PageTitle>Separador de Texto</PageTitle>

<MudContainer Fixed Class="ml-0" Style="width: 50%;">
    <MudTextField 
    AutoGrow 
    MaxLines="10" 
    T="string"
    Counter="0"
    @bind-Value = "@RawText"
    Clearable
    Label="Texto a ser separado"
    Class="mt-6"/>

    <MudTextField 
    Label="Máximo de caracteres por parte" 
    T="int"
    @bind-Value = "@MaximoCaracteres"
    MaxLength="5"
    Class="mt-6"/>

    <MudButton Color="Color.Success"
               OnClick="SepararTexto"
               Variant="Variant.Outlined"
               Style="align-self: end">
        Separar Texto
    </MudButton>

    @if (TextoSeparado.Any())
    {
        <MudContainer Fixed ="true" MaxWidth="MaxWidth.Large" Class="d-inline"> 
@*         @foreach (string texto in TextoSeparado)
        {
            <MudTextField T="string"
            Label="Resultado"
            AutoGrow MaxLines="15"
            Value="@texto"
            Class="mt-8 mb-8"
            ReadOnly
            />

            <MudSpacer/>
        } *@

        @for(var x = 0; x < @TextoSeparado.Count; x++)
        {
            <MudText>Parte @x</MudText>
                <MudTextField T="string"
                              AutoGrow MaxLines="15"
                              Value="@TextoSeparado[@x]"
                              Class="mt-8 mb-8"
                              ReadOnly />
        }
        </MudContainer>

    }


</MudContainer>

@code
{
    private string RawText { get; set; }
    private int MaximoCaracteres { get; set; }

    private List<string> TextoSeparado { get; set; } = new();

    private void SepararTexto()
    {
        string[] palavras = RawText.Split(' ');
        List<string> resultado = new();
        StringBuilder parteAtual = new StringBuilder();

        foreach (string palavra in palavras)
        {
            if (parteAtual.Length + palavra.Length + 1 > MaximoCaracteres)
            {
                resultado.Add(parteAtual.ToString().Trim());
                parteAtual.Clear();
            }

            if (palavra.Length > MaximoCaracteres)
            {
                if (parteAtual.Length > 0)
                {
                    resultado.Add(parteAtual.ToString().Trim());
                    parteAtual.Clear();
                }

                resultado.Add(palavra);
            }
            else
            {
                parteAtual.Append(palavra + " ");
            }
        }

        if (parteAtual.Length > 0)
            resultado.Add(parteAtual.ToString().Trim());

        TextoSeparado = resultado;
    }

}
;